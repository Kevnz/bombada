DGE.Sprite=function(conf){if(conf)this.init.apply(this,[conf]);};DGE.Sprite.prototype._id=null;DGE.Sprite.prototype._active=true;DGE.Sprite.prototype._children=null;DGE.Sprite.prototype._parent=null;DGE.Sprite.prototype._node=null;DGE.Sprite.prototype._visible=true;DGE.Sprite.prototype._width=0;DGE.Sprite.prototype._height=0;DGE.Sprite.prototype._x=0;DGE.Sprite.prototype._y=0;DGE.Sprite.prototype.init=function(conf,extra){var attrs,fns,i,set;if(extra)for(i in extra)conf[i]=extra[i];attrs={element:DGE.Sprite.defaults.nodeName,tWidth:DGE.Sprite.TILE_WIDTH,tHeight:DGE.Sprite.TILE_HEIGHT};for(i in attrs)if(conf[i]===undefined)conf[i]=attrs[i];set={width:null,height:null,tWidth:null,tHeight:null};for(i in set)if(i in conf)this[i]=conf[i];if(conf.id&&DGE.getNode(conf.id)){this._node=DGE.getNode(conf.id);}else{this._node=document.createElement(conf.element);}
if(conf.className)this._node.className=conf.className;this.setCSS('overflow','hidden');this.setCSS('position','absolute');this.angleChange=DGE.eventMethod(this);this.angle=DGE.attrMethod(this,this.angleChange);this.cursor=DGE.attrMethod(this,function(cursor){this.setCSS('cursor',(cursor?'pointer':'auto'));});this.downChange=DGE.eventMethod(this,function(fn){var that=this;this._node.onmousedown=function(){fn.apply(that);};});this.down=DGE.eventMethod(this,this.downChange);this.fillChange=DGE.eventMethod(this,function(color,setAll){if(setAll){this.setCSS('background',color);}else{this.setCSS('background-color',color);}});this.fill=DGE.attrMethod(this,this.fillChange);this.groupChange=DGE.eventMethod(this);this.group=DGE.attrMethod(this,this.groupChange);this.imageChange=DGE.eventMethod(this,function(url){this.setCSS('background-image',DGE.printf('url(%s%s)',DGE.conf.baseURL,url));});this.image=DGE.attrMethod(this,this.imageChange);this.move=DGE.eventMethod(this);this.onShow=DGE.eventMethod(this);this.onHide=DGE.eventMethod(this);this.ping=DGE.eventMethod(this);this.speedChange=DGE.eventMethod(this);this.speed=DGE.attrMethod(this,this.speedChange);this.zIndex=DGE.attrMethod(this,function(z){this.setCSS('z-index',z);});fns={align:null,angle:null,center:null,click:null,cursor:null,down:null,fill:null,group:null,hide:null,image:null,move:null,onShow:null,onHide:null,opacity:null,ping:null,over:null,out:null,speed:null,up:null,zIndex:null};for(i in fns)if(i in conf)this[i](conf[i]);conf.x=(conf.x||0);conf.y=(conf.y||0);this.plot(conf.x,conf.y);this.dimensions(conf.width,conf.height);this._id=(conf.id||DGE.makeId());this._node.id=this._id;if(conf.addTo){this.addTo(conf.addTo);}else if(conf.addTo!==false){this.addTo(DGE.stage);}
if(conf._active!==undefined){this._active=conf._active;}
return this;};DGE.Sprite.prototype.addChild=function(sprite){if(!this._children)this._children={};this._children[sprite._id]=sprite;sprite._parent=this;this._node.appendChild(sprite._node);DGE.Sprite._objects[sprite._id]=sprite;return this;};DGE.Sprite.prototype.addTo=function(sprite){sprite.addChild(this);return this;};DGE.Sprite.prototype.align=function(pos,offset){offset=(offset||0);switch(pos){case'left':this.plot(offset);break;case'right':this.plot(DGE.STAGE_WIDTH-this._width+offset);break;case'top':this.plot({y:offset});break;case'bottom':this.plot({y:(DGE.STAGE_HEIGHT-this._height+offset)});break;default:throw new Error(this.printf('Unknown setting "%s"',attr));}
return this;};DGE.Sprite.prototype.alignLeft=function(offset){return this.align('left',offset);};DGE.Sprite.prototype.alignRight=function(offset){return this.align('right',offset);};DGE.Sprite.prototype.alignTop=function(offset){return this.align('top',offset);};DGE.Sprite.prototype.alignBottom=function(offset){return this.align('bottom',offset);};DGE.Sprite.prototype.anchorToStage=function(){this.plot(this.getAbsoluteXY());return this.addTo(DGE.stage);};DGE.Sprite.prototype.angle=function(){};DGE.Sprite.prototype.angleChange=function(){};DGE.Sprite.prototype.angleTo=function(target,set){var coords=target.getAbsoluteXY();var toX=coords.x;var toY=coords.y;var x=(this._x-toX);var y=(this._y-toY);var angle=Math.atan2(y,x);angle=((angle*180)/Math.PI);if(set){this.angle(angle);this.move=DGE.Sprite.move.angle;return this;}
return angle;};DGE.Sprite.prototype.batch=function(methods){for(var k in methods){if(typeof(this[k])=='function'){this[k](methods[k]);}else{throw new Error(DGE.printf('%s is not a method',k));}}
return this;};DGE.Sprite.prototype.center=function(){return this.centerXY(true,true);};DGE.Sprite.prototype.centerX=function(){return this.centerXY(true,false);};DGE.Sprite.prototype.centerY=function(){return this.centerXY(false,true);};DGE.Sprite.prototype.centerXY=function(x,y){var p=this._node.parentNode;var width=p.offsetWidth;var height=p.offsetHeight;var newX=((width/2)-(this._node.offsetWidth/2));var newY=((height/2)-(this._node.offsetHeight/2));width=(width||DGE.STAGE_WIDTH);height=(height||DGE.STAGE_HEIGHT);return this.plot((x?newX:undefined),(y?newY:undefined));};DGE.Sprite.prototype.centerOn=function(target){var x=target._x;var y=target._y;x-=(this._width/2);y-=(this._height/2);x+=(target._width/2);y+=(target._height/2);if(target._node.parentNode!==this._node.parentNode){x+=target._node.parentNode.offsetLeft;y+=target._node.parentNode.offsetTop;}
return this.plot(x,y);};DGE.Sprite.prototype.click=function(fn){if(fn===undefined){if(this._click)this._click.apply(this);}else{var that=this;this._click=fn;this._node.onclick=function(e){if(e.clientX===undefined){e.clientX=e.pageX;e.clientY=e.pageY;}
that._click.apply(that,[e.clientX,e.clientY]);};}
this.clickChange=DGE.eventMethod(this,function(fn){var that=this;this._node.onclick=function(){fn.apply(that);};});this.click=DGE.eventMethod(this,this.clickChange);};DGE.Sprite.prototype.content=function(html){this._node.innerHTML=html;return this;};DGE.Sprite.prototype.dimensions=function(width,height){if((width===undefined)&&(height===undefined)){return{width:this._width,height:this._height};}
if(width!==undefined){this._width=width;if(typeof(width)=='number')width+='px';this.setCSS('width',width);}
if(height!==undefined){this._height=height;if(typeof(height)=='number')height+='px';this.setCSS('height',height);}
return this;};DGE.Sprite.prototype.exec=function(){return this.move().ping();};DGE.Sprite.prototype.fill=function(){};DGE.Sprite.prototype.fillChange=function(){};DGE.Sprite.prototype.getAbsoluteXY=function(){var x=this._x;var y=this._y;var p=this._parent;while(p){x+=p._x;y+=p._y;p=p._parent;}
return{x:x,y:y};};DGE.Sprite.prototype.group=function(){};DGE.Sprite.prototype.groupChange=function(){};DGE.Sprite.prototype.hide=function(delay){var that=this;if(delay){setTimeout(function(){that._visible=false;that.setCSS('display','none');},delay);}else{this._visible=false;this.setCSS('display','none');}
this.onHide();return this;};DGE.Sprite.prototype.image=function(){};DGE.Sprite.prototype.isTouching=function(sprite){var ax1=this._x;var ax2=(this._x+this._width);var ay1=this._y;var ay2=(this._y+this._height);var bx1=sprite._x;var bx2=(sprite._x+sprite._width);var by1=sprite._y;var by2=(sprite._y+sprite._height);return((ax1<bx2)&&(ax2>bx1)&&(ay1<by2)&&(ay2>by1));};DGE.Sprite.prototype.move=function(){};DGE.Sprite.prototype.isOutOfBounds=function(entirely){if(entirely)return((this._x<-this._width)||(this._x>DGE.STAGE_WIDTH)||(this._y<-this._height)||(this._y>DGE.STAGE_HEIGHT));return((this._x<0)||(this._x>(DGE.STAGE_WIDTH-this._width))||(this._y<0)||(this._y>(DGE.STAGE_HEIGHT-this._height)));};DGE.Sprite.prototype.opacity=function(opacity){return this.setCSS('opacity',opacity);};DGE.Sprite.prototype.over=function(fn){var that=this;this._node.onmouseover=function(){fn.apply(that);};return this;};DGE.Sprite.prototype.out=function(fn){var that=this;this._node.onmouseout=function(){fn.apply(that);};return this;};DGE.Sprite.prototype.plot=function(){if(arguments[0]!==undefined){if(typeof(arguments[0])=='number'){this._x=arguments[0];if(typeof(arguments[0])=='number'){this._y=arguments[1];}}else{if(typeof(arguments[0].x)=='number'){this._x=arguments[0].x;}
if(typeof(arguments[0].y)=='number'){this._y=arguments[0].y;}}}
return this.setCSS({left:(this._x+'px'),top:(this._y+'px')});};DGE.Sprite.prototype.remove=function(delay){var that=this;if(delay){setTimeout(function(){DGE.Sprite.removeById(that);},delay);}else{DGE.Sprite.removeById(this);}};DGE.Sprite.prototype.setCSS=function(key,value){DGE.setCSS(this._node,key,value);return this;};DGE.Sprite.prototype.show=function(){this._visible=true;this.onShow();return this.setCSS('display','');};DGE.Sprite.prototype.toggle=function(){if(this._visible){return this.hide();}else{return this.show();}};DGE.Sprite.prototype.x=function(x){this._x=x;return this.plot();};DGE.Sprite.prototype.y=function(y){this._y=y;return this.plot();};DGE.Sprite.prototype.zIndex=function(){};DGE.Sprite.defaults={nodeName:'div'};DGE.Sprite._objects={};DGE.Sprite.batch=function(sprites,method,arg){for(var i=0,l=sprites.length;i<l;i++){sprites[i][method](arg);}};DGE.Sprite.main=function(){for(var i in DGE.Sprite._objects){var sprite=DGE.Sprite._objects[i];if(sprite._active)sprite.exec();}};DGE.Sprite.getByGroup=function(group,method,arg){var found=[],objs=DGE.Sprite._objects;for(var i in objs){if(objs[i].group()==group)found.push(objs[i]);}
if(method!==undefined)DGE.Sprite.batch(found,method,arg);return(found.length?found:null);};DGE.Sprite.getById=function(id){return DGE.Sprite._objects[id];};DGE.Sprite.removeById=function(sprite){delete sprite._parent._children[sprite._id];sprite._node.parentNode.removeChild(sprite._node);delete DGE.Sprite._objects[sprite._id];};